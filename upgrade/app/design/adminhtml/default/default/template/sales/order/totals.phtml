<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php /*$_source = $this->getSource(); ?>
<?php $this->setPriceDataObject($_source) ?>
<?php if ($_source): ?>
<table cellspacing="0" width="100%">
    <?php echo $this->getChildHtml('main'); ?>
    <?php echo $this->getChildHtml('footer'); ?>
</table>
<?php endif;*/ 

$orderId = Mage::app()->getRequest()->getParam('order_id');
$order = Mage::getModel('sales/order')->load($orderId);
$grandTotal = $order->getGrandTotal();
$dp = $grandTotal - $order->getCuracaocustomerdiscount();
?>
<table cellspacing="0" width="100%">
    <col />
    <col width="1" />
    <?php $_totals = $this->getTotals('footer')?>
    <?php if ($_totals):?>
    <tfoot>
    <?php foreach ($this->getTotals('footer') as $_code => $_total): ?>
        <?php if ($_total->getBlockName()): ?>
            <?php echo $this->getChildHtml($_total->getBlockName(), false); ?>
        <?php else:?>
        <tr class="<?php echo $_code?>">
            <td <?php echo $this->getLabelProperties()?> class="label">
                <strong><?php echo $this->escapeHtml($_total->getLabel()); ?></strong>
            </td>
            <td <?php echo $this->getValueProperties()?> class="emph">
                <strong><?php echo $this->formatValue($_total) ?></strong>
            </td>
        </tr>
        <?php endif?>
    <?php endforeach?>
        <tr class="5">
                <td class="label">
                    <strong>Curacao Credit Payment</strong>
                </td>
                <td class="emph">
                    <strong><span class="price">$<?php echo $order->getCuracaocustomerdiscount();?></span></strong>
                </td>
         </tr>
         
          <tr class="6">
                <td class="label">
                    <strong><?php if($order->getCuracaocustomerdiscount()>0){?>Down Payment<?php }else{?> Credit Card Payment<?php }?></strong>
                </td>
                <td class="emph">
                    <strong><span class="price">$<?php echo $dp;?></span></strong>
                </td>
         </tr>
         	<tr class="7">
                <td class="label">
                    <strong>Estimate Number</strong>
                </td>
                <td class="emph">
                    <strong><span class="price"><?php echo $order->getEstimatenumber();?></span></strong>
                </td>
         </tr>
    </tfoot>
    <?php endif?>

    <?php $_totals = $this->getTotals('')?>
    <?php if ($_totals):?>
    <tbody>
    <?php foreach ($_totals as $_code => $_total): ?>
        <?php if ($_total->getBlockName()): ?>
            <?php echo $this->getChildHtml($_total->getBlockName(), false); ?>
        <?php else:?>
        <tr class="<?php echo $_code?>">
            <td <?php echo $this->getLabelProperties()?> class="label">
                <?php if ($_total->getStrong()):?>
                <strong><?php echo $this->escapeHtml($_total->getLabel()); ?></strong>
                <?php else:?>
                <?php echo $this->escapeHtml($_total->getLabel()); ?>
                <?php endif?>
            </td>
            <?php if ($_total->getStrong()):?>
            <td <?php echo $this->getValueProperties()?> class="emph">
                <strong><?php echo $this->formatValue($_total) ?></strong>
            <?php else:?>
            <td <?php echo $this->getValueProperties()?>>
                <?php echo $this->formatValue($_total) ?>
            <?php endif?>
            </td>
        </tr>
        <?php endif?>
    <?php endforeach?>
    </tbody>
    <?php endif?>
</table>
<?php //New Estuimate Adding Field ?>
	
    
    <div>
	Estimate Number : <input type="text" name="estNumber" id="estNumber" />
    <button  title="Submit Estimate" type="button" class="scalable save" onclick="return submitEstimate('<?php echo $orderId?>')" style=""><span><span><span>Submit</span></span></span></button>
</div>

 <div id="register_link" style="display:none"></div>
 <div id="registerloading" style="display:none"><img src="/images/gray_fade_small.gif"></div>

<!--<script global="" src="http://www.icuracao.com/js/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>-->
<script type="text/javascript">

	function submitEstimate(orderId){
			var estnumber = $('estNumber').getValue();
			var login_url = '/commonapi/api/addestimatenumber'
			 var parameters = {
									orderid: orderId,
									estimatenumber:estnumber
								}
			 new Ajax.Request(login_url, {
			                            method: 'post',
			                            parameters: parameters,
			                            onSuccess: function(transport)  {
			                               // summary.update(transport.responseText);
										   //alert(transport.responseText);
										   var result = transport.responseText.evalJSON();
										   if(result.success) {
												alert(result.message);
												window.location.reload();
										   }
										   
			                            }
			                        });
	}
	
	
	
	
</script>
<style>
    	#register_link{
		   top:0;
		   right:0;
		   width:100%;
		   height:100%;
		   position:fixed;
		   text-align:center;
		   /* IE filter */
		   filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50);
		   -moz-opacity:0.5;    /* Mozilla extension */
		   -khtml-opacity:0.5;  /* Safari/Conqueror extension */
		   opacity:0.5; /* CSS3 */
		   z-index:1000;
		   background-color:white;

		}
		#registerloading {
		   margin-top:100px;
		   position:fixed;
		   display:none;
		 }
    </style>
    
<?php //?>